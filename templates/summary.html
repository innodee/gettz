{% extends "base.html" %}
{% block content %}
  <h2>Monthly Summary</h2>

  <div class="card">
    <form method="get">
      <label>Month</label>
      <input type="month" name="month" value="{{ month }}" required>
      <div style="margin-top:10px;" class="btn-row">
        <button type="submit">View</button>
        <a class="btn" href="{{ url_for('export_summary_csv', month=month) }}">Export This Month CSV</a>
        <a class="btn" href="{{ url_for('monthly_close_pdf', month=month) }}">Monthly Close PDF</a>
      </div>
      <div class="small" style="margin-top:8px;">Showing {{ start }} to {{ end }}</div>
    </form>
  </div>

  <div class="card">
    <div class="grid">
      <div class="kpi">
        <div class="label">Total Sales</div>
        <div class="value">{{ "%.2f"|format(total_sales) }}</div>
      </div>
      <div class="kpi">
        <div class="label">Total Expenses</div>
        <div class="value">{{ "%.2f"|format(total_expenses) }}</div>
      </div>
      <div class="kpi">
        <div class="label">Net Profit</div>
        <div class="value">{{ "%.2f"|format(net_profit) }}</div>
      </div>
    </div>

    <div class="small" style="margin-top:10px;">
      Net Profit = Total Daily Profit - Total Expenses<br/>
      Total Daily Profit this month: {{ "%.2f"|format(total_profit) }}
    </div>
  </div>

  <div class="card">
    <h3>Sales This Month</h3>
    <table>
      <thead><tr><th>Date</th><th>Day</th><th>Total Sales</th><th>Daily Profit</th></tr></thead>
      <tbody>
        {% for r in sales_rows %}
          <tr>
            <td>{{ r.sale_date }}</td>
            <td>{{ r.day_name }}</td>
            <td>{{ "%.2f"|format(r.total_sales) }}</td>
            <td>{{ "%.2f"|format(r.daily_profit) }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="card">
    <h3>Expenses This Month</h3>
    <table>
      <thead><tr><th>Date</th><th>Description</th><th>Amount</th></tr></thead>
      <tbody>
        {% for r in expense_rows %}
          <tr>
            <td>{{ r.expense_date }}</td>
            <td>{{ r.description }}</td>
            <td>{{ "%.2f"|format(r.amount) }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}
